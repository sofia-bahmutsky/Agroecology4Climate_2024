{"title":"Formula","markdown":{"yaml":{"title":"Formula","format":"html"},"headingText":"CropResidueCalculator","containsRefs":false,"markdown":"\n\n1. $C_p$: Above and Belowground Residue Input\n\n$\\text{if} \\quad|(S_p - 100)| < 1 \\times 10^{-5}$\n$$\nC_p = [yield \\times (1 - \\frac{{moisture \\ content}}{100})] \\times {Carbon \\ concentration} \\quad \\text{(2.1.2-6)}\n$$\n\nOtherwise\n$$\nC_p = [(yield + yield \\times \\frac{S_p}{100}) \\times (1 - \\frac{{moisture \\ content}}{100})] \\times {Carbon \\ concentration} \n$$\n\n**Holos Code Reference**: [GitHub - Equation 2.1.2-6](https://github.com/holos-aafc/Holos/blob/21c18d94c871eaa1eaa2ab1d475eca0f0e34b35b/H.Core/Calculators/Carbon/ICBMSoilCarbonCalculator.cs#L270)\n\n**Variables**:\n\n- [$C_p$](#7-c_p-above-and-belowground-residue-input): Plant carbon in agricultural product ($kg ha^{-1}$)\n- $yield$: Crop yield (${kg} \\text{ wet weight } ha^{-1}$, default provided, user override)\n- $S_p$: Percentage of product yield returned to soil (user override)\n- $\\text{moisture content}$: Moisture content (%) of crop product [[Holos Table 7]](https://github.com/holos-aafc/Holos/blob/main/H.Content/Resources/Table_7_Relative_Biomass_Information.csv)\n- $\\text{Carbon concentration}$: C concentration of all plant parts ($kg kg^{-1}$)\n\n2. $C_{p\\_to\\_soil}$: Carbon input from product\n\n$$\nC_{{p\\_to\\_soil}} = C_p \\times \\frac{S_p}{100} \\quad \\text{(2.1.2-7)}\n$$\n\n**Holos Code Reference**: [GitHub - Equation 2.1.2-7](https://github.com/holos-aafc/Holos/blob/21c18d94c871eaa1eaa2ab1d475eca0f0e34b35b/H.Core/Calculators/Carbon/ICBMSoilCarbonCalculator.cs#L307)\n\n**Variables**:\n\n- [$C_{p\\_to\\_soil}$](#8-c_p_to_soil-carbon-input-from-product): Carbon input from product ($kg ha^{-1}$)\n- [$C_p$](#7-c_p-above-and-belowground-residue-input): Plant C (carbon) in agricultural product ($kg ha^{-1}$)\n- $S_p$: Percentage of product yield returned to soil (user override)\n\n### 3. $C_s$: Carbon Input from Straw\n\n$$\nC_s = C_p \\times \\frac{R_s}{R_p} \\times \\frac{S_s}{100} \\quad \\text{(2.1.2-8)}\n$$\n\n**Holos Code Reference**: [GitHub - Equation 2.1.2-8](https://github.com/holos-aafc/Holos/blob/21c18d94c871eaa1eaa2ab1d475eca0f0e34b35b/H.Core/Calculators/Carbon/ICBMSoilCarbonCalculator.cs#L344)\n\n**Variables**:\n\n- [$C_s$](#9-c_s-carbon-input-from-straw): C (carbon)  input from straw ($kg ha^{-1}$)\n- [$C_p$](#7-c_p-above-and-belowground-residue-input): Plant C (carbon) in agricultural product ($kg ha^{-1}$)\n- $R_s$: Relative biomass allocation coefficient for straw [[Holos Table 7]](https://github.com/holos-aafc/Holos/blob/main/H.Content/Resources/Table_7_Relative_Biomass_Information.csv)\n- $R_p$：Relative biomass allocation coefficient for product [[Holos Table 7]](https://github.com/holos-aafc/Holos/blob/main/H.Content/Resources/Table_7_Relative_Biomass_Information.csv)\n- $S_s$: Percentage of straw returned to soil (user override)\n\n### 4. $C_r$: Carbon input from Root\n\n$$\nC_r = C_p \\times \\frac{R_r}{R_p} \\times \\frac{S_r}{100} \\quad \\text{(2.1.2-9)}\n$$\n\n**Holos Code Reference**: [GitHub - Equation 2.1.2-9](https://github.com/holos-aafc/Holos/blob/21c18d94c871eaa1eaa2ab1d475eca0f0e34b35b/H.Core/Calculators/Carbon/ICBMSoilCarbonCalculator.cs#L398)\n\n**Variables**:\n\n- [$C_r$](#10-c_r-carbon-input-from-root): C (carbon)  input from roots ($kg ha^{-1}$)\n- [$C_p$](#7-c_p-above-and-belowground-residue-input):  Plant C (carbon) in agricultural product ($kg ha^{-1}$)\n- $R_r$:Relative biomass allocation coefficient for roots [[Holos Table 7]](https://github.com/holos-aafc/Holos/blob/main/H.Content/Resources/Table_7_Relative_Biomass_Information.csv)\n- $R_p$：Relative biomass allocation coefficient for product [[Holos Table 7]](https://github.com/holos-aafc/Holos/blob/main/H.Content/Resources/Table_7_Relative_Biomass_Information.csv)\n- $S_r$: Percentage of roots returned to soil (user override)\n\n### 5. $C_e$: Carbon Input from Exudate\n\n$$\nC_e = C_p \\times \\frac{R_e}{R_p} \\quad \\text{(2.1.2-9)}\n$$\n\n**Holos Code Reference**: [GitHub - Equation 2.1.2-9](https://github.com/holos-aafc/Holos/blob/21c18d94c871eaa1eaa2ab1d475eca0f0e34b35b/H.Core/Calculators/Carbon/ICBMSoilCarbonCalculator.cs#L398)\n\n**Variables**:\n\n- [$C_e$](#11-c_e-carbon-input-from-exudate): C (carbon) input from extra-root material ($kg ha^{-1}$)\n- [$C_p$](#7-c_p-above-and-belowground-residue-input): Plant C (carbon) in agricultural product ($kg ha^{-1}$)\n- $R_e$: Relative biomass allocation coefficient for extra-root material [[Holos Table 7]](https://github.com/holos-aafc/Holos/blob/main/H.Content/Resources/Table_7_Relative_Biomass_Information.csv)\n- $R_p$: Relative biomass allocation coefficient for product [[Holos Table 7]](https://github.com/holos-aafc/Holos/blob/main/H.Content/Resources/Table_7_Relative_Biomass_Information.csv)\n\n### 6. $Grain_N$\n\n$$\n{Grain}_N = \\frac{C_{p\\_to\\_soil}}{0.45} \\times \\frac{N_p}{1000}\\quad \\text{(2.5.6-2)}\n$$\n\n**Holos Code Reference**: [Holos GitHub - Equation 2.5.6-2](https://github.com/holos-aafc/Holos/blob/21c18d94c871eaa1eaa2ab1d475eca0f0e34b35b/H.Core/Calculators/Nitrogen/N2OEmissionFactorCalculator.cs#L561)\n\n**Variables**:\n\n- [${Grain}_N$](#3-grain_n): Nitrogen content of the grain returned to the soil ($kg N ha^{-1}$)\n- [$C_{p\\_to\\_soil}$](#8-carbon-input-from-product): Carbon input from product ($kg ha^{-1}$)\n- $N_p$: N concentration in the product ($kg kg^{-1}$) [[Holos Table 7]](https://github.com/holos-aafc/Holos/blob/main/H.Content/Resources/Table_7_Relative_Biomass_Information.csv)\n\n### 7. $Straw_N$\n\n$$\n{Straw}_N = \\frac{C_s}{0.45} \\times \\frac{N_s}{1000} \\quad \\text{(2.5.6-3)}\n$$\n\n**Holos Code Reference**: [GitHub - Equation 2.5.6-3](https://github.com/holos-aafc/Holos/blob/21c18d94c871eaa1eaa2ab1d475eca0f0e34b35b/H.Core/Calculators/Nitrogen/N2OEmissionFactorCalculator.cs#L575)\n\n**Variables**:\n\n- [${Straw}_N$](#4-straw_n): Nitrogen content of the straw returned to the soil ($kg N ha^{-1}$)\n- [$C_s$](#9-c_s-carbon-input-from-straw): Carbon input from straw ($kg ha^{-1}$)\n- $N_s$: N concentration in the straw ($kg kg^{-1}$) [[Holos Table 7]](https://github.com/holos-aafc/Holos/blob/main/H.Content/Resources/Table_7_Relative_Biomass_Information.csv)\n\n### 8. $Root_N$\n\n$$\n{Root}_N = \\frac{C_r}{0.45} \\times \\frac{N_r}{1000}\\quad \\text{(2.5.6-4)}\n$$\n\n**Holos Code Reference**: [GitHub - Equation 2.5.6-4](https://github.com/holos-aafc/Holos/blob/21c18d94c871eaa1eaa2ab1d475eca0f0e34b35b/H.Core/Calculators/Nitrogen/N2OEmissionFactorCalculator.cs#L589)\n\n**Variables**:\n\n- [${Root}_N$](#5-root_n): Nitrogen content of the root returned to the soil ($kg N ha^{-1}$)\n- [$C_r$](#10-c_r-carbon-input-from-root): Carbon input from roots ($kg ha^{-1}$)\n- $N_r$: N concentration in the roots ($kg kg^{-1}$) [[Holos Table 7]](https://github.com/holos-aafc/Holos/blob/main/H.Content/Resources/Table_7_Relative_Biomass_Information.csv)\n\n### 9. $Exudate_N$\n\n$$\n{Exudate}_N = \\frac{C_e}{0.45} \\times \\frac{N_e}{1000} \\quad \\text{(2.5.6-5)}\n$$\n\n**Holos Code Reference**: [GitHub - Equation 2.5.6-5](https://github.com/holos-aafc/Holos/blob/21c18d94c871eaa1eaa2ab1d475eca0f0e34b35b/H.Core/Calculators/Nitrogen/N2OEmissionFactorCalculator.cs#L603)\n\n**Variables**:\n\n- [$\\text{Exudate}_N$](#6-exudate_n): Nitrogen content of the exudates returned to the soil ($kg N ha^{-1}$)\n- [$C_e$](#11-c_e-carbon-input-from-exudate): Carbon input from extra-root material ($kg ha^{-1}$)\n- $N_e$: N concentration in the extra root material ($kg kg^{-1}$) [[Holos Table 7]](https://github.com/holos-aafc/Holos/blob/main/H.Content/Resources/Table_7_Relative_Biomass_Information.csv)\n\n### 10. AboveGround Residue Nitrogen\nFor Annual and Perennial Plants,\n\n$$\nAboveGround_{residue\\_N} = [{Grain_N} + {Straw_N}] \\quad \\text{(2.5.6-6)}\n$$\n For Root Plant,\n\n$$\nAboveGround_{residue\\_N} = {Straw_N} \\quad \\text{(2.5.6-6)}\n$$\nFor Cover and Silage Plant,\n\n$$\nAboveGround_{residue\\_N} = {Grain_N} \\quad \\text{(2.5.6-6)}\n$$\n\n**Holos Code Reference**: [Holos GitHub - Equation 2.5.6-6](https://github.com/holos-aafc/Holos/blob/21c18d94c871eaa1eaa2ab1d475eca0f0e34b35b/H.Core/Calculators/Nitrogen/N2OEmissionFactorCalculator.cs#L617)\n\n**Variables**:\n\n- [$AboveGround_{residue\\_N}$](#1-aboveground-residue-nitrogen): Nitrogen in above-ground crop residues ($kg N$)\n- [${Grain_N}$](#6-grain_n): Nitrogen content of the grain returned to the soil ($kg N ha^{-1}$)\n- [${Straw_N}$](#7-straw_n): Nitrogen content of the straw returned to the soil ($kg N ha^{-1}$)\n\n### 11. BelowGround Residue Nitrogen\n\nFor annual plants:\n\n$$\nBelowGround_{{residue_N}} = [{Root_N} + {Exudate_N}] \\quad \\text{(2.5.6-7)}\n$$\n\n**Holos Code Reference**: [Holos GitHub - Equation 2.5.6-7](https://github.com/holos-aafc/Holos/blob/21c18d94c871eaa1eaa2ab1d475eca0f0e34b35b/H.Core/Calculators/Nitrogen/N2OEmissionFactorCalculator.cs#L679)\n\nFor perennial plants:\n\n$$\nBelowGround_{residue_N} = [\\frac{S_r}{100} \\times {Root}_N] + {Exudate_N} \\quad \\text{(2.5.6-8)}\n$$\n\nFor root plant,\n\n$$\nBelowGround_{residue_N} = {Grian_N} + {Exudate_N} \\quad \\text{(2.5.6-8)}\n$$\n\nFor cover and silage plant,\n\n$$\nBelowGround_{residue_N} = {Root_N} + {Exudate_N} \\quad \\text{(2.5.6-8)}\n$$\n\n**Holos Code Reference**: [Holos GitHub - Equation 2.5.6-8](https://github.com/holos-aafc/Holos/blob/21c18d94c871eaa1eaa2ab1d475eca0f0e34b35b/H.Core/Calculators/Nitrogen/N2OEmissionFactorCalculator.cs#L685)\n\n**Variables**:\n\n- [$BelowGround_{residue\\_N}$](#2-belowground-residue-nitrogen): Belowground residue nitrogen ($kg N ha^{-1}$)\n- [${Root_N}$](#8-root_n): Nitrogen content of the root returned to the soil ($kg N ha^{-1}$)\n- [${Exudate_N}$](#9-exudate_n): Nitrogen content of the exudates returned to the soil ($kg N ha^{-1}$)\n- $S_r$: Root turnover fraction\n\n### 12. The total nitrogen content of the crop residue($N_{crop\\_residues}$).\n$$\nN_{CropResidues} = (AboveGround_{residue\\_N} + BelowGround_{residue\\_N}) \\times {area} \\quad \\text{(2.5.6-9)}\n$$\n\n**Variables**:\n\n- $N_{CropResidues}$: resulting from crop residues and N mineralization\n- [$AboveGround_{residue\\_N}$](#1-aboveground-residue-nitrogen): Aboveground residue nitrogen ($kg N ha^{-1}$)\n- [$BelowGround_{residue\\_N}$](#2-belowground-residue-nitrogen): Belowground residue nitrogen $kg N ha^{-1}$\n- $area$: Area of crop ($ha$)\n\n### Carbon Input\n\n**Above ground carbon input**\n\nFor root plants:\n\n$$\nAboveGround_{carboninput} = c_s\n$$\n\nothers plant,\n$$\nAboveGround_{carboninput} = C_{p\\_to\\_soil} + C_s\n$$\n\n**Below ground carbon input**\n\nFor root plants:\n\n$$\nBelowGround_{carboninput} = C_{p\\_to\\_soil} + C_e\n$$\n\nothers plant,\n$$\nAboveGround_{carboninput} = C_r + C_e\n$$\n\n### EmissionFactorCalculator\n\n### 1. Calculate Base Emission Factor - Due to Ecodistrict-level Emission Factor\n\n\n\nFor humid environment:$P > PE$\n\n$$\nEF_{CT} = \\exp^{0.00558 \\times P - 7.7} \\quad(2.5.1-1)\n$$\nFor dry environment $PE \\geq P$\n\n$$\nEF_{CT}= \\exp^{0.00558 \\times PE - 7.7}\\quad(2.5.1-2)\n$$ \n\n**Holos Code Reference**: [GitHub - Equation 2.5.1](https://github.com/holos-aafc/Holos/blob/6f24e78c7bd46ae35848906933475f077562cd0d/H.Core/Calculators/Nitrogen/N2OEmissionFactorCalculator.cs#L880)\n\n**Variables**:\n\n- $EF_{CT}$: Ecodistrict-level emission factor ($kg \\, N_2O\\text{-}N \\, (kg \\, N)^{-1}$)\n- $P$: Annual growing season precipitation (May – October)(mm)\n- $PE$: Growing season potential evapotranspiration, by ecodistrict (May – October) (mm)\n\n### 2. Calculate Emission Factor Adjustment Due to Position in Landscape/Topography\n\nFor humid environments $P > PE$ : \n\n$$\nEF_{Topo} = EF_{CT} \\quad(2.5.2-1)\n$$\n\nFor dry environment $PE \\geq P$:\n\n- For non-irrigated sites:\n\n$$\nEF_{Topo} = (EF\\\\\\_CT_{P < PE}\\times FR_{Topo}) + [EF\\\\\\_CT_{P>PE} \\times (1 - FR_{Topo})] \\quad(2.5.2-2)\n$$\n\nFor irrigated sites, the assumption is that the irrigation amount is equal to PE - P, thus making P = PE, \n\n$$\nEF_{Topo} = EF_{CT} \\quad (2.5.2-3)\n$$ \n\n**Holos Code Reference**: [GitHub - Equation 2.5.2](https://github.com/holos-aafc/Holos/blob/6f24e78c7bd46ae35848906933475f077562cd0d/H.Core/Calculators/Nitrogen/N2OEmissionFactorCalculator.cs#L381)\n\n**Variables**:\n\n- $EF_{Topo}$: N2O emission factor adjusted due to position in landscape and moisture regime ($kg \\, N_2O\\text{-}N$)\n- $FR_{Topo}$: Fraction of land occupied by lower portions of the landscape\n\n### 3. Calculate Emission Factor Adjustment Due to Soil Texture\n\n$$\nEF_{Base} = (EF_{Topo} \\times RF\\_TX) \\times \\frac{1}{0.645} \\quad (2.5.3-2)\n$$\n\n$$\nEF = EF_{Base} * RF\\_NS * RF\\_Till *RF\\_CS * RF\\_AM\n$$\n\n**Holos Code Reference**: [GitHub - Equation 2.5.3-2](https://github.com/holos-aafc/Holos/blob/6f24e78c7bd46ae35848906933475f077562cd0d/H.Core/Calculators/Nitrogen/N2OEmissionFactorCalculator.cs#L451)\n\n**Variables**:\n\n- $RF\\_TX$: Weighted modifier which provides a correction of the $EF\\_Topo$ in ecodistrict based on the soil texture.\n- $EF\\_Base$: A function of the three factors that create a base ecodistrict-specific value that accounts for the climatic, topographic, and edaphic characteristics of the spatial unit for lands.\n- $\\frac{1}{0.645}$: Fraction of growing season emissions of total annual emissions (Pelster et al. 2022, in prep.).\n\n### EmissionCalculator\n\n### 1. Calculate The direct nitrogen emission from crop residue\n\n$$\nN_2O_{N_{CropResidues}} = N_{CropResidues} \\times EF \\quad \\text{(2.6.5-2)}\n$$ \n\n**Holos Code Reference**: [GitHub - Equation 2.6.5-2](https://github.com/holos-aafc/Holos/blob/6f24e78c7bd46ae35848906933475f077562cd0d/H.Core/Calculators/Carbon/CarbonCalculatorBase.Nitrogen.cs#L377)\n\n**Variables**:\n\n- $N_2O_{N_{CropResidues}}$: Direct N₂O emissions ($kg \\, N_2O\\text{-}N \\, ha^{-1}$) resulting from crop residues \n- $N_{CropResidues}$: N (nitrogen) inputs from crop residue returned to soil ($kg N$)\n- $EF$: Emission factor for crop residue nitrogen \n\n### 2. The total direct nitrogen emission from all crop sources\n\n$N_2O_{N_{direct}} = N_2O_{N_{SNdirect}} + N_2O_{N_{CropResidues}} + N_2O_{N_{CRNmindirect}} + N_2O_{N_{ONdirect}}$\n\n**Notes:**\n\nCurrently, only Nitrogen Direct Emission from crop residues is calculated, as this only accounts for crop-related factors and not livestock, fertilizer, and manure.\n\n**Variables**:\n\n- $N_2O_{N_{SNdirect}}$: N₂O emissions ($kg \\, N_2O\\text{-}N \\, kg^{-1} \\, N \\, ha^{-1}$) resulting from fertilizer application\n- $N_2O_{N_{CropResidues}}$: N₂O emissions ($kg \\, N_2O\\text{-}N \\, kg^{-1} \\, N \\, ha^{-1}$) resulting from crop residues (and N mineralization?)\n- $N_2O_{N_{CRNmindirect}}$: N₂O emissions ($kg \\, N_2O\\text{-}N \\, kg^{-1} \\, N \\, ha^{-1}$) resulting from N mineralization\n- $N_2O_{N_{ONdirect}}$: N₂O emissions ($kg \\, N_2O\\text{-}N \\, kg^{-1} \\, N \\, ha^{-1}$) resulting from organic fertilizers\n\n### 3. Convert $N₂O_N$ to N₂O\n\n$$\nN_2O = N_2O_N \\times \\frac{44}{28}\n$$\n\n**Variables**:\n\n- $\\frac{44}{28}$: Conversion factor from N₂O_N to N₂O based on molecular mass\n\n### 4. Calculate CO₂ Equivalent of N₂O Emissions\n\n$$\nCO_2 = N_2O \\times 273\n$$\n\n**Notes:**\n\nHolos uses 273 as the Global Warming Potential value for N₂O. [Holos Reference](https://github.com/holos-aafc/Holos/blob/6f24e78c7bd46ae35848906933475f077562cd0d/H.Core/CoreConstants.cs#L135)\n\n**Variables**:\n\n- $273$: Global Warming Potential for N₂O compared to CO₂\n\n\n### Scientific mode Vs Farm mode\n\n**Difference**\n\n**Data source: Default data VS External Data**\n\n**extract_default_climate_soil_data()**\n Workflow:\n\n1. Load the Holos defaults data for climate, soil, ecodistrict polygons, and RF_TX (differentiated by soil_texture [west/east])\n\n2. Based on longitude and latitude, get the ECO_ID for the farm, then fetch all necessary data (P, PE, soil type, and RF_TX)\n\n- climate_soil_dict\n\n**fetch_external_data(self, points, years_range)**\n\n- **ExternalClimateFetcher**\n- fetch climate data through API (NASA), can get specific climate data within specific year.\n- Calculate P and PE using daily precipitation and evapotranspiration.\n- get climate_data（）\n- **ExternalSoilTextureDataFetcher**\n- Load all data source:\n 1. HWSP_SMU_csv[smu_df](Soil Mapping Unit Data)（Harmonized World Soil Database V2.0）\n 2. D_TEXTURE_DSDA.csv[texture_df](Soil Texture Data)\n 3. HWSD2_RASTER[raster_path]\n 4. rf_tx_params_dist.json[texture_mapped_path]\n- get_raster_value(lon,lat),find SMU_ID\n- then use smu_df == SMU_ID,to find texture code,texure code corresponing to a texture type,\n- finally we use the sampling_rf_tx()\n\n\n**Function**\n- Farmer mode: Expects all arrays to have a length of 1.\n\n- Scientific mode: Expects arrays to have lengths greater than 1.\n- Scientific mode:\n - random_points = generate_random_points(\n                    polygon, num_points=self.num_runs\n                )\nbased on the location of main farm , to generate the point\n- climate_data, soil_data = self.fetch_external_data(points, self.year_range) within the farm's ecodistrict.\n- sampling_fr_topo(farm_ecod_fr_topo, self.num_runs)\n- Farm mode:\n - extract_default_climate_soil_data() -> climate_soil_dict\n\n### Process\n- initial dataset:\n\n{python}\n{'farm_id': 'farm1', 'area': 10.0, 'latitude': 49.99704167, 'longitude': -123.2373389, 'crop': 'Soybean', 'yield': 2700.0, 'start_year': 2021, 'end_year': 2021, 'eco_id': None}\n、、、\n**FarmDataManager**\n\n{'farm_id': 'farm1', 'area': 10.0, 'latitude': 49.99704167, 'longitude': -123.2373389, 'crop': 'Soybean', 'yield': 2700.0, 'start_year': 2021, 'end_year': 2021, 'eco_id': None, 'province': 'British Columbia', 'group': 'Annual'}\n\n### ClimateSoilDataManager\n**def get_climate_soil_data(self):**\n- climate_soil_data = climate_soil_manager.get_climate_soil_data()\n\n{'P': array([512.]), 'PE': array([483.]), 'FR_Topo': array([0.]), 'locations': array([[-123.2373389 ,   49.99704167]]), 'soil_texture': array([1.])}\n\n### CropParametersManager\n- def get_crop_parameters(self): Holos defined parameter\n- def load_user_distributions(self): user defined crop parameters\n### 1. Evapotranspiration \n\n**Parameter**:\n\n- mean_daily_temperature(T)\n- solar_radiation (S)\n- relative_humidity (R) % \n\nUse Turc equation to calculate Reference evapotranspiration\n\n$$\nPE = 0\n\\begin{cases} \n\\text{if} T \\leq 0, \\\\ \n\\text{if} |T + 15| \\leq 1* 10^{-10}\n\\end{cases}\n$$\nif mean_daily_temperature $\\leq 0$, $PE = 0$\n\n\\begin{align*}\n\\text{term1} &= 0.013\\\\\n\\text{term2} &= \\frac{T}{T + 15} \\\\\n\\text{term3} &= (23.8856 \\times S ) + 50 \\\\\n\\text{term4} &= 1 + \\frac{(50 - R)}{70} \\\\\n\\\\\n\\text{if } &\\text{relative\\_humidity} \\geq 50: \\\\\n&\\text{PE} = \\text{term1} \\times \\text{term2} \\times \\text{term3} \\\\\n\\text{else:} \\\\\n&\\text{PE} = \\text{term1} \\times \\text{term2} \\times \\text{term3} \\times \\text{term4}\\\\\n\\text{if } & PE \\leq 0, \\text{return} 0\n\\end{align*}\n\n### Question\n\n**def sampling_fr_topo**\\\\\n\n- I am not sure how much the fr_topo influnce the result, \\\\\n- the chosen : low = value * 0.75, high = value * 1.25  (here is this come from)\n[1. Capturing Natural Variability?\n2.Balance Between Accuracy and Flexibility?]\n- what is  N mineralization variable\n- ask this one $N_{CropResidues}$: N (nitrogen) inputs from crop residue returned to soil ($kg N$)\n\n- do we need to introduce CO₂?\n\n","srcMarkdownNoYaml":"\n### CropResidueCalculator\n\n1. $C_p$: Above and Belowground Residue Input\n\n$\\text{if} \\quad|(S_p - 100)| < 1 \\times 10^{-5}$\n$$\nC_p = [yield \\times (1 - \\frac{{moisture \\ content}}{100})] \\times {Carbon \\ concentration} \\quad \\text{(2.1.2-6)}\n$$\n\nOtherwise\n$$\nC_p = [(yield + yield \\times \\frac{S_p}{100}) \\times (1 - \\frac{{moisture \\ content}}{100})] \\times {Carbon \\ concentration} \n$$\n\n**Holos Code Reference**: [GitHub - Equation 2.1.2-6](https://github.com/holos-aafc/Holos/blob/21c18d94c871eaa1eaa2ab1d475eca0f0e34b35b/H.Core/Calculators/Carbon/ICBMSoilCarbonCalculator.cs#L270)\n\n**Variables**:\n\n- [$C_p$](#7-c_p-above-and-belowground-residue-input): Plant carbon in agricultural product ($kg ha^{-1}$)\n- $yield$: Crop yield (${kg} \\text{ wet weight } ha^{-1}$, default provided, user override)\n- $S_p$: Percentage of product yield returned to soil (user override)\n- $\\text{moisture content}$: Moisture content (%) of crop product [[Holos Table 7]](https://github.com/holos-aafc/Holos/blob/main/H.Content/Resources/Table_7_Relative_Biomass_Information.csv)\n- $\\text{Carbon concentration}$: C concentration of all plant parts ($kg kg^{-1}$)\n\n2. $C_{p\\_to\\_soil}$: Carbon input from product\n\n$$\nC_{{p\\_to\\_soil}} = C_p \\times \\frac{S_p}{100} \\quad \\text{(2.1.2-7)}\n$$\n\n**Holos Code Reference**: [GitHub - Equation 2.1.2-7](https://github.com/holos-aafc/Holos/blob/21c18d94c871eaa1eaa2ab1d475eca0f0e34b35b/H.Core/Calculators/Carbon/ICBMSoilCarbonCalculator.cs#L307)\n\n**Variables**:\n\n- [$C_{p\\_to\\_soil}$](#8-c_p_to_soil-carbon-input-from-product): Carbon input from product ($kg ha^{-1}$)\n- [$C_p$](#7-c_p-above-and-belowground-residue-input): Plant C (carbon) in agricultural product ($kg ha^{-1}$)\n- $S_p$: Percentage of product yield returned to soil (user override)\n\n### 3. $C_s$: Carbon Input from Straw\n\n$$\nC_s = C_p \\times \\frac{R_s}{R_p} \\times \\frac{S_s}{100} \\quad \\text{(2.1.2-8)}\n$$\n\n**Holos Code Reference**: [GitHub - Equation 2.1.2-8](https://github.com/holos-aafc/Holos/blob/21c18d94c871eaa1eaa2ab1d475eca0f0e34b35b/H.Core/Calculators/Carbon/ICBMSoilCarbonCalculator.cs#L344)\n\n**Variables**:\n\n- [$C_s$](#9-c_s-carbon-input-from-straw): C (carbon)  input from straw ($kg ha^{-1}$)\n- [$C_p$](#7-c_p-above-and-belowground-residue-input): Plant C (carbon) in agricultural product ($kg ha^{-1}$)\n- $R_s$: Relative biomass allocation coefficient for straw [[Holos Table 7]](https://github.com/holos-aafc/Holos/blob/main/H.Content/Resources/Table_7_Relative_Biomass_Information.csv)\n- $R_p$：Relative biomass allocation coefficient for product [[Holos Table 7]](https://github.com/holos-aafc/Holos/blob/main/H.Content/Resources/Table_7_Relative_Biomass_Information.csv)\n- $S_s$: Percentage of straw returned to soil (user override)\n\n### 4. $C_r$: Carbon input from Root\n\n$$\nC_r = C_p \\times \\frac{R_r}{R_p} \\times \\frac{S_r}{100} \\quad \\text{(2.1.2-9)}\n$$\n\n**Holos Code Reference**: [GitHub - Equation 2.1.2-9](https://github.com/holos-aafc/Holos/blob/21c18d94c871eaa1eaa2ab1d475eca0f0e34b35b/H.Core/Calculators/Carbon/ICBMSoilCarbonCalculator.cs#L398)\n\n**Variables**:\n\n- [$C_r$](#10-c_r-carbon-input-from-root): C (carbon)  input from roots ($kg ha^{-1}$)\n- [$C_p$](#7-c_p-above-and-belowground-residue-input):  Plant C (carbon) in agricultural product ($kg ha^{-1}$)\n- $R_r$:Relative biomass allocation coefficient for roots [[Holos Table 7]](https://github.com/holos-aafc/Holos/blob/main/H.Content/Resources/Table_7_Relative_Biomass_Information.csv)\n- $R_p$：Relative biomass allocation coefficient for product [[Holos Table 7]](https://github.com/holos-aafc/Holos/blob/main/H.Content/Resources/Table_7_Relative_Biomass_Information.csv)\n- $S_r$: Percentage of roots returned to soil (user override)\n\n### 5. $C_e$: Carbon Input from Exudate\n\n$$\nC_e = C_p \\times \\frac{R_e}{R_p} \\quad \\text{(2.1.2-9)}\n$$\n\n**Holos Code Reference**: [GitHub - Equation 2.1.2-9](https://github.com/holos-aafc/Holos/blob/21c18d94c871eaa1eaa2ab1d475eca0f0e34b35b/H.Core/Calculators/Carbon/ICBMSoilCarbonCalculator.cs#L398)\n\n**Variables**:\n\n- [$C_e$](#11-c_e-carbon-input-from-exudate): C (carbon) input from extra-root material ($kg ha^{-1}$)\n- [$C_p$](#7-c_p-above-and-belowground-residue-input): Plant C (carbon) in agricultural product ($kg ha^{-1}$)\n- $R_e$: Relative biomass allocation coefficient for extra-root material [[Holos Table 7]](https://github.com/holos-aafc/Holos/blob/main/H.Content/Resources/Table_7_Relative_Biomass_Information.csv)\n- $R_p$: Relative biomass allocation coefficient for product [[Holos Table 7]](https://github.com/holos-aafc/Holos/blob/main/H.Content/Resources/Table_7_Relative_Biomass_Information.csv)\n\n### 6. $Grain_N$\n\n$$\n{Grain}_N = \\frac{C_{p\\_to\\_soil}}{0.45} \\times \\frac{N_p}{1000}\\quad \\text{(2.5.6-2)}\n$$\n\n**Holos Code Reference**: [Holos GitHub - Equation 2.5.6-2](https://github.com/holos-aafc/Holos/blob/21c18d94c871eaa1eaa2ab1d475eca0f0e34b35b/H.Core/Calculators/Nitrogen/N2OEmissionFactorCalculator.cs#L561)\n\n**Variables**:\n\n- [${Grain}_N$](#3-grain_n): Nitrogen content of the grain returned to the soil ($kg N ha^{-1}$)\n- [$C_{p\\_to\\_soil}$](#8-carbon-input-from-product): Carbon input from product ($kg ha^{-1}$)\n- $N_p$: N concentration in the product ($kg kg^{-1}$) [[Holos Table 7]](https://github.com/holos-aafc/Holos/blob/main/H.Content/Resources/Table_7_Relative_Biomass_Information.csv)\n\n### 7. $Straw_N$\n\n$$\n{Straw}_N = \\frac{C_s}{0.45} \\times \\frac{N_s}{1000} \\quad \\text{(2.5.6-3)}\n$$\n\n**Holos Code Reference**: [GitHub - Equation 2.5.6-3](https://github.com/holos-aafc/Holos/blob/21c18d94c871eaa1eaa2ab1d475eca0f0e34b35b/H.Core/Calculators/Nitrogen/N2OEmissionFactorCalculator.cs#L575)\n\n**Variables**:\n\n- [${Straw}_N$](#4-straw_n): Nitrogen content of the straw returned to the soil ($kg N ha^{-1}$)\n- [$C_s$](#9-c_s-carbon-input-from-straw): Carbon input from straw ($kg ha^{-1}$)\n- $N_s$: N concentration in the straw ($kg kg^{-1}$) [[Holos Table 7]](https://github.com/holos-aafc/Holos/blob/main/H.Content/Resources/Table_7_Relative_Biomass_Information.csv)\n\n### 8. $Root_N$\n\n$$\n{Root}_N = \\frac{C_r}{0.45} \\times \\frac{N_r}{1000}\\quad \\text{(2.5.6-4)}\n$$\n\n**Holos Code Reference**: [GitHub - Equation 2.5.6-4](https://github.com/holos-aafc/Holos/blob/21c18d94c871eaa1eaa2ab1d475eca0f0e34b35b/H.Core/Calculators/Nitrogen/N2OEmissionFactorCalculator.cs#L589)\n\n**Variables**:\n\n- [${Root}_N$](#5-root_n): Nitrogen content of the root returned to the soil ($kg N ha^{-1}$)\n- [$C_r$](#10-c_r-carbon-input-from-root): Carbon input from roots ($kg ha^{-1}$)\n- $N_r$: N concentration in the roots ($kg kg^{-1}$) [[Holos Table 7]](https://github.com/holos-aafc/Holos/blob/main/H.Content/Resources/Table_7_Relative_Biomass_Information.csv)\n\n### 9. $Exudate_N$\n\n$$\n{Exudate}_N = \\frac{C_e}{0.45} \\times \\frac{N_e}{1000} \\quad \\text{(2.5.6-5)}\n$$\n\n**Holos Code Reference**: [GitHub - Equation 2.5.6-5](https://github.com/holos-aafc/Holos/blob/21c18d94c871eaa1eaa2ab1d475eca0f0e34b35b/H.Core/Calculators/Nitrogen/N2OEmissionFactorCalculator.cs#L603)\n\n**Variables**:\n\n- [$\\text{Exudate}_N$](#6-exudate_n): Nitrogen content of the exudates returned to the soil ($kg N ha^{-1}$)\n- [$C_e$](#11-c_e-carbon-input-from-exudate): Carbon input from extra-root material ($kg ha^{-1}$)\n- $N_e$: N concentration in the extra root material ($kg kg^{-1}$) [[Holos Table 7]](https://github.com/holos-aafc/Holos/blob/main/H.Content/Resources/Table_7_Relative_Biomass_Information.csv)\n\n### 10. AboveGround Residue Nitrogen\nFor Annual and Perennial Plants,\n\n$$\nAboveGround_{residue\\_N} = [{Grain_N} + {Straw_N}] \\quad \\text{(2.5.6-6)}\n$$\n For Root Plant,\n\n$$\nAboveGround_{residue\\_N} = {Straw_N} \\quad \\text{(2.5.6-6)}\n$$\nFor Cover and Silage Plant,\n\n$$\nAboveGround_{residue\\_N} = {Grain_N} \\quad \\text{(2.5.6-6)}\n$$\n\n**Holos Code Reference**: [Holos GitHub - Equation 2.5.6-6](https://github.com/holos-aafc/Holos/blob/21c18d94c871eaa1eaa2ab1d475eca0f0e34b35b/H.Core/Calculators/Nitrogen/N2OEmissionFactorCalculator.cs#L617)\n\n**Variables**:\n\n- [$AboveGround_{residue\\_N}$](#1-aboveground-residue-nitrogen): Nitrogen in above-ground crop residues ($kg N$)\n- [${Grain_N}$](#6-grain_n): Nitrogen content of the grain returned to the soil ($kg N ha^{-1}$)\n- [${Straw_N}$](#7-straw_n): Nitrogen content of the straw returned to the soil ($kg N ha^{-1}$)\n\n### 11. BelowGround Residue Nitrogen\n\nFor annual plants:\n\n$$\nBelowGround_{{residue_N}} = [{Root_N} + {Exudate_N}] \\quad \\text{(2.5.6-7)}\n$$\n\n**Holos Code Reference**: [Holos GitHub - Equation 2.5.6-7](https://github.com/holos-aafc/Holos/blob/21c18d94c871eaa1eaa2ab1d475eca0f0e34b35b/H.Core/Calculators/Nitrogen/N2OEmissionFactorCalculator.cs#L679)\n\nFor perennial plants:\n\n$$\nBelowGround_{residue_N} = [\\frac{S_r}{100} \\times {Root}_N] + {Exudate_N} \\quad \\text{(2.5.6-8)}\n$$\n\nFor root plant,\n\n$$\nBelowGround_{residue_N} = {Grian_N} + {Exudate_N} \\quad \\text{(2.5.6-8)}\n$$\n\nFor cover and silage plant,\n\n$$\nBelowGround_{residue_N} = {Root_N} + {Exudate_N} \\quad \\text{(2.5.6-8)}\n$$\n\n**Holos Code Reference**: [Holos GitHub - Equation 2.5.6-8](https://github.com/holos-aafc/Holos/blob/21c18d94c871eaa1eaa2ab1d475eca0f0e34b35b/H.Core/Calculators/Nitrogen/N2OEmissionFactorCalculator.cs#L685)\n\n**Variables**:\n\n- [$BelowGround_{residue\\_N}$](#2-belowground-residue-nitrogen): Belowground residue nitrogen ($kg N ha^{-1}$)\n- [${Root_N}$](#8-root_n): Nitrogen content of the root returned to the soil ($kg N ha^{-1}$)\n- [${Exudate_N}$](#9-exudate_n): Nitrogen content of the exudates returned to the soil ($kg N ha^{-1}$)\n- $S_r$: Root turnover fraction\n\n### 12. The total nitrogen content of the crop residue($N_{crop\\_residues}$).\n$$\nN_{CropResidues} = (AboveGround_{residue\\_N} + BelowGround_{residue\\_N}) \\times {area} \\quad \\text{(2.5.6-9)}\n$$\n\n**Variables**:\n\n- $N_{CropResidues}$: resulting from crop residues and N mineralization\n- [$AboveGround_{residue\\_N}$](#1-aboveground-residue-nitrogen): Aboveground residue nitrogen ($kg N ha^{-1}$)\n- [$BelowGround_{residue\\_N}$](#2-belowground-residue-nitrogen): Belowground residue nitrogen $kg N ha^{-1}$\n- $area$: Area of crop ($ha$)\n\n### Carbon Input\n\n**Above ground carbon input**\n\nFor root plants:\n\n$$\nAboveGround_{carboninput} = c_s\n$$\n\nothers plant,\n$$\nAboveGround_{carboninput} = C_{p\\_to\\_soil} + C_s\n$$\n\n**Below ground carbon input**\n\nFor root plants:\n\n$$\nBelowGround_{carboninput} = C_{p\\_to\\_soil} + C_e\n$$\n\nothers plant,\n$$\nAboveGround_{carboninput} = C_r + C_e\n$$\n\n### EmissionFactorCalculator\n\n### 1. Calculate Base Emission Factor - Due to Ecodistrict-level Emission Factor\n\n\n\nFor humid environment:$P > PE$\n\n$$\nEF_{CT} = \\exp^{0.00558 \\times P - 7.7} \\quad(2.5.1-1)\n$$\nFor dry environment $PE \\geq P$\n\n$$\nEF_{CT}= \\exp^{0.00558 \\times PE - 7.7}\\quad(2.5.1-2)\n$$ \n\n**Holos Code Reference**: [GitHub - Equation 2.5.1](https://github.com/holos-aafc/Holos/blob/6f24e78c7bd46ae35848906933475f077562cd0d/H.Core/Calculators/Nitrogen/N2OEmissionFactorCalculator.cs#L880)\n\n**Variables**:\n\n- $EF_{CT}$: Ecodistrict-level emission factor ($kg \\, N_2O\\text{-}N \\, (kg \\, N)^{-1}$)\n- $P$: Annual growing season precipitation (May – October)(mm)\n- $PE$: Growing season potential evapotranspiration, by ecodistrict (May – October) (mm)\n\n### 2. Calculate Emission Factor Adjustment Due to Position in Landscape/Topography\n\nFor humid environments $P > PE$ : \n\n$$\nEF_{Topo} = EF_{CT} \\quad(2.5.2-1)\n$$\n\nFor dry environment $PE \\geq P$:\n\n- For non-irrigated sites:\n\n$$\nEF_{Topo} = (EF\\\\\\_CT_{P < PE}\\times FR_{Topo}) + [EF\\\\\\_CT_{P>PE} \\times (1 - FR_{Topo})] \\quad(2.5.2-2)\n$$\n\nFor irrigated sites, the assumption is that the irrigation amount is equal to PE - P, thus making P = PE, \n\n$$\nEF_{Topo} = EF_{CT} \\quad (2.5.2-3)\n$$ \n\n**Holos Code Reference**: [GitHub - Equation 2.5.2](https://github.com/holos-aafc/Holos/blob/6f24e78c7bd46ae35848906933475f077562cd0d/H.Core/Calculators/Nitrogen/N2OEmissionFactorCalculator.cs#L381)\n\n**Variables**:\n\n- $EF_{Topo}$: N2O emission factor adjusted due to position in landscape and moisture regime ($kg \\, N_2O\\text{-}N$)\n- $FR_{Topo}$: Fraction of land occupied by lower portions of the landscape\n\n### 3. Calculate Emission Factor Adjustment Due to Soil Texture\n\n$$\nEF_{Base} = (EF_{Topo} \\times RF\\_TX) \\times \\frac{1}{0.645} \\quad (2.5.3-2)\n$$\n\n$$\nEF = EF_{Base} * RF\\_NS * RF\\_Till *RF\\_CS * RF\\_AM\n$$\n\n**Holos Code Reference**: [GitHub - Equation 2.5.3-2](https://github.com/holos-aafc/Holos/blob/6f24e78c7bd46ae35848906933475f077562cd0d/H.Core/Calculators/Nitrogen/N2OEmissionFactorCalculator.cs#L451)\n\n**Variables**:\n\n- $RF\\_TX$: Weighted modifier which provides a correction of the $EF\\_Topo$ in ecodistrict based on the soil texture.\n- $EF\\_Base$: A function of the three factors that create a base ecodistrict-specific value that accounts for the climatic, topographic, and edaphic characteristics of the spatial unit for lands.\n- $\\frac{1}{0.645}$: Fraction of growing season emissions of total annual emissions (Pelster et al. 2022, in prep.).\n\n### EmissionCalculator\n\n### 1. Calculate The direct nitrogen emission from crop residue\n\n$$\nN_2O_{N_{CropResidues}} = N_{CropResidues} \\times EF \\quad \\text{(2.6.5-2)}\n$$ \n\n**Holos Code Reference**: [GitHub - Equation 2.6.5-2](https://github.com/holos-aafc/Holos/blob/6f24e78c7bd46ae35848906933475f077562cd0d/H.Core/Calculators/Carbon/CarbonCalculatorBase.Nitrogen.cs#L377)\n\n**Variables**:\n\n- $N_2O_{N_{CropResidues}}$: Direct N₂O emissions ($kg \\, N_2O\\text{-}N \\, ha^{-1}$) resulting from crop residues \n- $N_{CropResidues}$: N (nitrogen) inputs from crop residue returned to soil ($kg N$)\n- $EF$: Emission factor for crop residue nitrogen \n\n### 2. The total direct nitrogen emission from all crop sources\n\n$N_2O_{N_{direct}} = N_2O_{N_{SNdirect}} + N_2O_{N_{CropResidues}} + N_2O_{N_{CRNmindirect}} + N_2O_{N_{ONdirect}}$\n\n**Notes:**\n\nCurrently, only Nitrogen Direct Emission from crop residues is calculated, as this only accounts for crop-related factors and not livestock, fertilizer, and manure.\n\n**Variables**:\n\n- $N_2O_{N_{SNdirect}}$: N₂O emissions ($kg \\, N_2O\\text{-}N \\, kg^{-1} \\, N \\, ha^{-1}$) resulting from fertilizer application\n- $N_2O_{N_{CropResidues}}$: N₂O emissions ($kg \\, N_2O\\text{-}N \\, kg^{-1} \\, N \\, ha^{-1}$) resulting from crop residues (and N mineralization?)\n- $N_2O_{N_{CRNmindirect}}$: N₂O emissions ($kg \\, N_2O\\text{-}N \\, kg^{-1} \\, N \\, ha^{-1}$) resulting from N mineralization\n- $N_2O_{N_{ONdirect}}$: N₂O emissions ($kg \\, N_2O\\text{-}N \\, kg^{-1} \\, N \\, ha^{-1}$) resulting from organic fertilizers\n\n### 3. Convert $N₂O_N$ to N₂O\n\n$$\nN_2O = N_2O_N \\times \\frac{44}{28}\n$$\n\n**Variables**:\n\n- $\\frac{44}{28}$: Conversion factor from N₂O_N to N₂O based on molecular mass\n\n### 4. Calculate CO₂ Equivalent of N₂O Emissions\n\n$$\nCO_2 = N_2O \\times 273\n$$\n\n**Notes:**\n\nHolos uses 273 as the Global Warming Potential value for N₂O. [Holos Reference](https://github.com/holos-aafc/Holos/blob/6f24e78c7bd46ae35848906933475f077562cd0d/H.Core/CoreConstants.cs#L135)\n\n**Variables**:\n\n- $273$: Global Warming Potential for N₂O compared to CO₂\n\n\n### Scientific mode Vs Farm mode\n\n**Difference**\n\n**Data source: Default data VS External Data**\n\n**extract_default_climate_soil_data()**\n Workflow:\n\n1. Load the Holos defaults data for climate, soil, ecodistrict polygons, and RF_TX (differentiated by soil_texture [west/east])\n\n2. Based on longitude and latitude, get the ECO_ID for the farm, then fetch all necessary data (P, PE, soil type, and RF_TX)\n\n- climate_soil_dict\n\n**fetch_external_data(self, points, years_range)**\n\n- **ExternalClimateFetcher**\n- fetch climate data through API (NASA), can get specific climate data within specific year.\n- Calculate P and PE using daily precipitation and evapotranspiration.\n- get climate_data（）\n- **ExternalSoilTextureDataFetcher**\n- Load all data source:\n 1. HWSP_SMU_csv[smu_df](Soil Mapping Unit Data)（Harmonized World Soil Database V2.0）\n 2. D_TEXTURE_DSDA.csv[texture_df](Soil Texture Data)\n 3. HWSD2_RASTER[raster_path]\n 4. rf_tx_params_dist.json[texture_mapped_path]\n- get_raster_value(lon,lat),find SMU_ID\n- then use smu_df == SMU_ID,to find texture code,texure code corresponing to a texture type,\n- finally we use the sampling_rf_tx()\n\n\n**Function**\n- Farmer mode: Expects all arrays to have a length of 1.\n\n- Scientific mode: Expects arrays to have lengths greater than 1.\n- Scientific mode:\n - random_points = generate_random_points(\n                    polygon, num_points=self.num_runs\n                )\nbased on the location of main farm , to generate the point\n- climate_data, soil_data = self.fetch_external_data(points, self.year_range) within the farm's ecodistrict.\n- sampling_fr_topo(farm_ecod_fr_topo, self.num_runs)\n- Farm mode:\n - extract_default_climate_soil_data() -> climate_soil_dict\n\n### Process\n- initial dataset:\n\n{python}\n{'farm_id': 'farm1', 'area': 10.0, 'latitude': 49.99704167, 'longitude': -123.2373389, 'crop': 'Soybean', 'yield': 2700.0, 'start_year': 2021, 'end_year': 2021, 'eco_id': None}\n、、、\n**FarmDataManager**\n\n{'farm_id': 'farm1', 'area': 10.0, 'latitude': 49.99704167, 'longitude': -123.2373389, 'crop': 'Soybean', 'yield': 2700.0, 'start_year': 2021, 'end_year': 2021, 'eco_id': None, 'province': 'British Columbia', 'group': 'Annual'}\n\n### ClimateSoilDataManager\n**def get_climate_soil_data(self):**\n- climate_soil_data = climate_soil_manager.get_climate_soil_data()\n\n{'P': array([512.]), 'PE': array([483.]), 'FR_Topo': array([0.]), 'locations': array([[-123.2373389 ,   49.99704167]]), 'soil_texture': array([1.])}\n\n### CropParametersManager\n- def get_crop_parameters(self): Holos defined parameter\n- def load_user_distributions(self): user defined crop parameters\n### 1. Evapotranspiration \n\n**Parameter**:\n\n- mean_daily_temperature(T)\n- solar_radiation (S)\n- relative_humidity (R) % \n\nUse Turc equation to calculate Reference evapotranspiration\n\n$$\nPE = 0\n\\begin{cases} \n\\text{if} T \\leq 0, \\\\ \n\\text{if} |T + 15| \\leq 1* 10^{-10}\n\\end{cases}\n$$\nif mean_daily_temperature $\\leq 0$, $PE = 0$\n\n\\begin{align*}\n\\text{term1} &= 0.013\\\\\n\\text{term2} &= \\frac{T}{T + 15} \\\\\n\\text{term3} &= (23.8856 \\times S ) + 50 \\\\\n\\text{term4} &= 1 + \\frac{(50 - R)}{70} \\\\\n\\\\\n\\text{if } &\\text{relative\\_humidity} \\geq 50: \\\\\n&\\text{PE} = \\text{term1} \\times \\text{term2} \\times \\text{term3} \\\\\n\\text{else:} \\\\\n&\\text{PE} = \\text{term1} \\times \\text{term2} \\times \\text{term3} \\times \\text{term4}\\\\\n\\text{if } & PE \\leq 0, \\text{return} 0\n\\end{align*}\n\n### Question\n\n**def sampling_fr_topo**\\\\\n\n- I am not sure how much the fr_topo influnce the result, \\\\\n- the chosen : low = value * 0.75, high = value * 1.25  (here is this come from)\n[1. Capturing Natural Variability?\n2.Balance Between Accuracy and Flexibility?]\n- what is  N mineralization variable\n- ask this one $N_{CropResidues}$: N (nitrogen) inputs from crop residue returned to soil ($kg N$)\n\n- do we need to introduce CO₂?\n\n"},"formats":{"html":{"identifier":{"display-name":"HTML","target-format":"html","base-format":"html"},"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":"auto","echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"ipynb-shell-interactivity":null,"plotly-connected":true,"engine":"markdown"},"render":{"keep-tex":false,"keep-typ":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-min-runs":1,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[],"notebook-links":true},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","toc":true,"output-file":"equations.html"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","other-links-title":"Other Links","code-links-title":"Code Links","launch-dev-container-title":"Launch Dev Container","launch-binder-title":"Launch Binder","article-notebook-label":"Article Notebook","notebook-preview-download":"Download Notebook","notebook-preview-download-src":"Download Source","notebook-preview-back":"Back to Article","manuscript-meca-bundle":"MECA Bundle","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","appendix-view-license":"View License","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","title-block-keywords":"Keywords","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","tools-share":"Share","tools-download":"Download","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-text-placeholder":"","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-wordcount":"Word Count","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items","listing-page-words":"{0} words","listing-page-filter":"Filter","draft":"Draft"},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.5.57","publish":{"gh-pages":{"branch":"Anny","repo":"sofia-bahmutsky/Agroecology4Climate_2024"}},"theme":{"light":"flatly","dark":"darkly"},"title":"Formula"},"extensions":{"book":{"multiFile":true}}}},"projectFormats":["html"]}